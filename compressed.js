"use strict";function isSameArray(e,t){var i;if(!e||!t||e.length!=t.length)return!1;for(i=e.length-1;i>=0;i--)if(e[i]!==t[i])return!1;return!0}function walContext(){this.ctx=new window.AudioContext,this.destination=this.ctx.destination,this.filters=this.createFilters(),this.buffers=[],this.compositions=[],this.nbPlaying=0,this.filters.connect(this.destination),this.nodeIn=this.filters.nodeIn,delete this.filters.connect}function pushAction(e,t){gs.history.push({name:"select",action:{func:gs.history.select,samples:e&&e.length?e:null,removedSamples:t},undo:{func:gs.history.undoSelect,samples:t,removedSamples:e&&e.length?e:null}})}!function(){function e(e){var t=keyboardRouter.defaultOptions,i=e.fn||t.fn,n={name:e.name,when:(e.when||t.when).toUpperCase(),preventDefault:void 0!==e.preventDefault?e.preventDefault:t.preventDefault,alt:!1,ctrl:!1,shift:!1,keys:[]};return n.fn=i.bind(e.thisArg||t.thisArg,e),e.keys.forEach(function(e){e=e.toUpperCase(),"ALT"===e?n.alt=!0:"CTRL"===e?n.ctrl=!0:"SHIFT"===e?n.shift=!0:n.keys.push(1===e.length?e.charCodeAt(0):keyboardRouter.keys[e])}),n}function t(){for(;o.length;){var e=o.pop();e.active&&(delete e.active,e.fn({type:"keyup"}))}}function i(e){var t=e.keyCode;s[t]||(s[t]=!0,a.some(function(i){if(!(i.active||e.altKey!==i.alt||e.ctrlKey!==i.ctrl||e.shiftKey!==i.shift||i.keys.length&&t!==i.keys[0])&&(i.fn(e),i.when.indexOf("UP")>-1&&(i.active=!0,o.push(i)),i.preventDefault!==!1))return e.preventDefault(),!0}))}function n(e){var t,i,n,a=e.keyCode,l=o.length;if(s[a]=!1,l){for(n=[],t=l-1;t>=0;--t)i=o[t],i.active&&(i.alt&&!e.altKey||i.ctrl&&!e.ctrlKey||i.shift&&!e.shiftKey||i.keys.length||a===i.keys[0])&&n.push(t);n.forEach(function(t){i=o[t],delete i.active,i.fn(e),o.splice(t,1)})}}var s=[],a=[],o=[];window.keyboardRouter=function(){for(var s=0,o=arguments.length;s<o;)a.push(e(arguments[s++]));document.body.addEventListener("keydown",i),document.body.addEventListener("keyup",n),window.addEventListener("blur",t)},keyboardRouter.defaultOptions={when:"down",fn:function(){},preventDefault:!0},keyboardRouter.keys={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPSLOCK:20,ESCAPE:27,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,OS:91,CONTEXTMENU:93,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUMLOCK:144,SCROLLLOCK:145}}(),function(){function e(e,t,i){return i||(i=t,t=document),e?n(t.querySelectorAll(i)):t.querySelector(i)}function t(e,t){var i,n=1,s=t.classList;for(aLen=arguments.length,lastArg=arguments[aLen-1],"boolean"==typeof lastArg&&(e=lastArg,--aLen);i=arguments[++n];)s.toggle(i,e)}function i(e,t){if(e){if(void 0===e.length)return t(e,0);for(var i,n,s=0;n=e[s];++s)if(void 0!==(i=t(n,s)))return i}}function n(e){return e.every=o,e.forEach=l,e.some=r,e}var s=window.wisdom={},a=[],o=a.every,l=a.forEach,r=a.some;s.querySelector=s.qS=e.bind(null,!1),s.querySelectorAll=s.qSA=e.bind(null,!0),s.createElement=s.cE=function(e){if("<"!==e[0])return document.createElement(e);var t=document.createElement("div");return t.innerHTML=e,n(t.children)},s.css=function(e,t,n){var s=arguments.length;return i(e,s>2?function(e){e.style[t]=n}:function(e){var i=getComputedStyle(e);return s>1?i[t]:i})},s.cLc=function(e,t){return e.classList.contains(t)},s.cLa=t.bind(null,!0),s.cLr=t.bind(null,!1),s.cLt=t.bind(null,void 0),s.classList={contains:s.cLc,add:s.cLa,remove:s.cLr,toggle:s.cLt}}(),!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Handlebars=t():e.Handlebars=t()}(this,function(){return function(e){function t(n){if(i[n])return i[n].exports;var s=i[n]={exports:{},id:n,loaded:!1};return e[n].call(s.exports,s,s.exports,t),s.loaded=!0,s.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t,i){function n(){var e=new l.HandlebarsEnvironment;return f.extend(e,l),e.SafeString=u.default,e.Exception=d.default,e.Utils=f,e.escapeExpression=f.escapeExpression,e.VM=h,e.template=function(t){return h.template(t,e)},e}var s=i(1).default,a=i(2).default;t.__esModule=!0;var o=i(3),l=s(o),r=i(17),u=a(r),c=i(5),d=a(c),p=i(4),f=s(p),m=i(18),h=s(m),g=i(19),v=a(g),w=n();w.create=n,v.default(w),w.default=w,t.default=w,e.exports=t.default},function(e,t){t.default=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t},t.__esModule=!0},function(e,t){t.default=function(e){return e&&e.__esModule?e:{default:e}},t.__esModule=!0},function(e,t,i){function n(e,t,i){this.helpers=e||{},this.partials=t||{},this.decorators=i||{},r.registerDefaultHelpers(this),u.registerDefaultDecorators(this)}var s=i(2).default;t.__esModule=!0,t.HandlebarsEnvironment=n;var a=i(4),o=i(5),l=s(o),r=i(6),u=i(14),c=i(16),d=s(c),p="4.0.5";t.VERSION=p;var f=7;t.COMPILER_REVISION=f;var m={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:"== 1.x.x",5:"== 2.0.0-alpha.x",6:">= 2.0.0-beta.1",7:">= 4.0.0"};t.REVISION_CHANGES=m;var h="[object Object]";n.prototype={constructor:n,logger:d.default,log:d.default.log,registerHelper:function(e,t){if(a.toString.call(e)===h){if(t)throw new l.default("Arg not supported with multiple helpers");a.extend(this.helpers,e)}else this.helpers[e]=t},unregisterHelper:function(e){delete this.helpers[e]},registerPartial:function(e,t){if(a.toString.call(e)===h)a.extend(this.partials,e);else{if("undefined"==typeof t)throw new l.default('Attempting to register a partial called "'+e+'" as undefined');this.partials[e]=t}},unregisterPartial:function(e){delete this.partials[e]},registerDecorator:function(e,t){if(a.toString.call(e)===h){if(t)throw new l.default("Arg not supported with multiple decorators");a.extend(this.decorators,e)}else this.decorators[e]=t},unregisterDecorator:function(e){delete this.decorators[e]}};var g=d.default.log;t.log=g,t.createFrame=a.createFrame,t.logger=d.default},function(e,t){function i(e){return c[e]}function n(e){for(var t=1;t<arguments.length;t++)for(var i in arguments[t])Object.prototype.hasOwnProperty.call(arguments[t],i)&&(e[i]=arguments[t][i]);return e}function s(e,t){for(var i=0,n=e.length;n>i;i++)if(e[i]===t)return i;return-1}function a(e){if("string"!=typeof e){if(e&&e.toHTML)return e.toHTML();if(null==e)return"";if(!e)return e+"";e=""+e}return p.test(e)?e.replace(d,i):e}function o(e){return!e&&0!==e||!(!h(e)||0!==e.length)}function l(e){var t=n({},e);return t._parent=e,t}function r(e,t){return e.path=t,e}function u(e,t){return(e?e+".":"")+t}t.__esModule=!0,t.extend=n,t.indexOf=s,t.escapeExpression=a,t.isEmpty=o,t.createFrame=l,t.blockParams=r,t.appendContextPath=u;var c={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;","=":"&#x3D;"},d=/[&<>"'`=]/g,p=/[&<>"'`=]/,f=Object.prototype.toString;t.toString=f;var m=function(e){return"function"==typeof e};m(/x/)&&(t.isFunction=m=function(e){return"function"==typeof e&&"[object Function]"===f.call(e)}),t.isFunction=m;var h=Array.isArray||function(e){return!(!e||"object"!=typeof e)&&"[object Array]"===f.call(e)};t.isArray=h},function(e,t){function i(e,t){var s=t&&t.loc,a=void 0,o=void 0;s&&(a=s.start.line,o=s.start.column,e+=" - "+a+":"+o);for(var l=Error.prototype.constructor.call(this,e),r=0;r<n.length;r++)this[n[r]]=l[n[r]];Error.captureStackTrace&&Error.captureStackTrace(this,i),s&&(this.lineNumber=a,this.column=o)}t.__esModule=!0;var n=["description","fileName","lineNumber","message","name","number","stack"];i.prototype=new Error,t.default=i,e.exports=t.default},function(e,t,i){function n(e){o.default(e),r.default(e),c.default(e),p.default(e),m.default(e),g.default(e),w.default(e)}var s=i(2).default;t.__esModule=!0,t.registerDefaultHelpers=n;var a=i(7),o=s(a),l=i(8),r=s(l),u=i(9),c=s(u),d=i(10),p=s(d),f=i(11),m=s(f),h=i(12),g=s(h),v=i(13),w=s(v)},function(e,t,i){t.__esModule=!0;var n=i(4);t.default=function(e){e.registerHelper("blockHelperMissing",function(t,i){var s=i.inverse,a=i.fn;if(t===!0)return a(this);if(t===!1||null==t)return s(this);if(n.isArray(t))return t.length>0?(i.ids&&(i.ids=[i.name]),e.helpers.each(t,i)):s(this);if(i.data&&i.ids){var o=n.createFrame(i.data);o.contextPath=n.appendContextPath(i.data.contextPath,i.name),i={data:o}}return a(t,i)})},e.exports=t.default},function(e,t,i){var n=i(2).default;t.__esModule=!0;var s=i(4),a=i(5),o=n(a);t.default=function(e){e.registerHelper("each",function(e,t){function i(t,i,a){u&&(u.key=t,u.index=i,u.first=0===i,u.last=!!a,c&&(u.contextPath=c+t)),r+=n(e[t],{data:u,blockParams:s.blockParams([e[t],t],[c+t,null])})}if(!t)throw new o.default("Must pass iterator to #each");var n=t.fn,a=t.inverse,l=0,r="",u=void 0,c=void 0;if(t.data&&t.ids&&(c=s.appendContextPath(t.data.contextPath,t.ids[0])+"."),s.isFunction(e)&&(e=e.call(this)),t.data&&(u=s.createFrame(t.data)),e&&"object"==typeof e)if(s.isArray(e))for(var d=e.length;d>l;l++)l in e&&i(l,l,l===e.length-1);else{var p=void 0;for(var f in e)e.hasOwnProperty(f)&&(void 0!==p&&i(p,l-1),p=f,l++);void 0!==p&&i(p,l-1,!0)}return 0===l&&(r=a(this)),r})},e.exports=t.default},function(e,t,i){var n=i(2).default;t.__esModule=!0;var s=i(5),a=n(s);t.default=function(e){e.registerHelper("helperMissing",function(){if(1!==arguments.length)throw new a.default('Missing helper: "'+arguments[arguments.length-1].name+'"')})},e.exports=t.default},function(e,t,i){t.__esModule=!0;var n=i(4);t.default=function(e){e.registerHelper("if",function(e,t){return n.isFunction(e)&&(e=e.call(this)),!t.hash.includeZero&&!e||n.isEmpty(e)?t.inverse(this):t.fn(this)}),e.registerHelper("unless",function(t,i){return e.helpers.if.call(this,t,{fn:i.inverse,inverse:i.fn,hash:i.hash})})},e.exports=t.default},function(e,t){t.__esModule=!0,t.default=function(e){e.registerHelper("log",function(){for(var t=[void 0],i=arguments[arguments.length-1],n=0;n<arguments.length-1;n++)t.push(arguments[n]);var s=1;null!=i.hash.level?s=i.hash.level:i.data&&null!=i.data.level&&(s=i.data.level),t[0]=s,e.log.apply(e,t)})},e.exports=t.default},function(e,t){t.__esModule=!0,t.default=function(e){e.registerHelper("lookup",function(e,t){return e&&e[t]})},e.exports=t.default},function(e,t,i){t.__esModule=!0;var n=i(4);t.default=function(e){e.registerHelper("with",function(e,t){n.isFunction(e)&&(e=e.call(this));var i=t.fn;if(n.isEmpty(e))return t.inverse(this);var s=t.data;return t.data&&t.ids&&(s=n.createFrame(t.data),s.contextPath=n.appendContextPath(t.data.contextPath,t.ids[0])),i(e,{data:s,blockParams:n.blockParams([e],[s&&s.contextPath])})})},e.exports=t.default},function(e,t,i){function n(e){o.default(e)}var s=i(2).default;t.__esModule=!0,t.registerDefaultDecorators=n;var a=i(15),o=s(a)},function(e,t,i){t.__esModule=!0;var n=i(4);t.default=function(e){e.registerDecorator("inline",function(e,t,i,s){var a=e;return t.partials||(t.partials={},a=function(s,a){var o=i.partials;i.partials=n.extend({},o,t.partials);var l=e(s,a);return i.partials=o,l}),t.partials[s.args[0]]=s.fn,a})},e.exports=t.default},function(e,t,i){t.__esModule=!0;var n=i(4),s={methodMap:["debug","info","warn","error"],level:"info",lookupLevel:function(e){if("string"==typeof e){var t=n.indexOf(s.methodMap,e.toLowerCase());e=t>=0?t:parseInt(e,10)}return e},log:function(e){if(e=s.lookupLevel(e),"undefined"!=typeof console&&s.lookupLevel(s.level)<=e){var t=s.methodMap[e];console[t]||(t="log");for(var i=arguments.length,n=Array(i>1?i-1:0),a=1;i>a;a++)n[a-1]=arguments[a];console[t].apply(console,n)}}};t.default=s,e.exports=t.default},function(e,t){function i(e){this.string=e}t.__esModule=!0,i.prototype.toString=i.prototype.toHTML=function(){return""+this.string},t.default=i,e.exports=t.default},function(e,t,i){function n(e){var t=e&&e[0]||1,i=v.COMPILER_REVISION;if(t!==i){if(i>t){var n=v.REVISION_CHANGES[i],s=v.REVISION_CHANGES[t];throw new g.default("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+n+") or downgrade your runtime to an older version ("+s+").")}throw new g.default("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+e[1]+").")}}function s(e,t){function i(i,n,s){s.hash&&(n=m.extend({},n,s.hash),s.ids&&(s.ids[0]=!0)),i=t.VM.resolvePartial.call(this,i,n,s);var a=t.VM.invokePartial.call(this,i,n,s);if(null==a&&t.compile&&(s.partials[s.name]=t.compile(i,e.compilerOptions,t),a=s.partials[s.name](n,s)),null!=a){if(s.indent){for(var o=a.split("\n"),l=0,r=o.length;r>l&&(o[l]||l+1!==r);l++)o[l]=s.indent+o[l];a=o.join("\n")}return a}throw new g.default("The partial "+s.name+" could not be compiled when running in runtime-only mode")}function n(t){function i(t){return""+e.main(s,t,s.helpers,s.partials,o,r,l)}var a=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],o=a.data;n._setup(a),!a.partial&&e.useData&&(o=u(t,o));var l=void 0,r=e.useBlockParams?[]:void 0;return e.useDepths&&(l=a.depths?t!==a.depths[0]?[t].concat(a.depths):a.depths:[t]),(i=c(e.main,i,s,a.depths||[],o,r))(t,a)}if(!t)throw new g.default("No environment passed to template");if(!e||!e.main)throw new g.default("Unknown template object: "+typeof e);e.main.decorator=e.main_d,t.VM.checkRevision(e.compiler);var s={strict:function(e,t){if(!(t in e))throw new g.default('"'+t+'" not defined in '+e);return e[t]},lookup:function(e,t){for(var i=e.length,n=0;i>n;n++)if(e[n]&&null!=e[n][t])return e[n][t]},lambda:function(e,t){return"function"==typeof e?e.call(t):e},escapeExpression:m.escapeExpression,invokePartial:i,fn:function(t){var i=e[t];return i.decorator=e[t+"_d"],i},programs:[],program:function(e,t,i,n,s){var o=this.programs[e],l=this.fn(e);return t||s||n||i?o=a(this,e,l,t,i,n,s):o||(o=this.programs[e]=a(this,e,l)),o},data:function(e,t){for(;e&&t--;)e=e._parent;return e},merge:function(e,t){var i=e||t;return e&&t&&e!==t&&(i=m.extend({},t,e)),i},noop:t.VM.noop,compilerInfo:e.compiler};return n.isTop=!0,n._setup=function(i){i.partial?(s.helpers=i.helpers,s.partials=i.partials,s.decorators=i.decorators):(s.helpers=s.merge(i.helpers,t.helpers),e.usePartial&&(s.partials=s.merge(i.partials,t.partials)),(e.usePartial||e.useDecorators)&&(s.decorators=s.merge(i.decorators,t.decorators)))},n._child=function(t,i,n,o){if(e.useBlockParams&&!n)throw new g.default("must pass block params");if(e.useDepths&&!o)throw new g.default("must pass parent depths");return a(s,t,e[t],i,0,n,o)},n}function a(e,t,i,n,s,a,o){function l(t){var s=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],l=o;return o&&t!==o[0]&&(l=[t].concat(o)),i(e,t,e.helpers,e.partials,s.data||n,a&&[s.blockParams].concat(a),l)}return l=c(i,l,e,o,n,a),l.program=t,l.depth=o?o.length:0,l.blockParams=s||0,l}function o(e,t,i){return e?e.call||i.name||(i.name=e,e=i.partials[e]):e="@partial-block"===i.name?i.data["partial-block"]:i.partials[i.name],e}function l(e,t,i){i.partial=!0,i.ids&&(i.data.contextPath=i.ids[0]||i.data.contextPath);var n=void 0;if(i.fn&&i.fn!==r&&(i.data=v.createFrame(i.data),n=i.data["partial-block"]=i.fn,n.partials&&(i.partials=m.extend({},i.partials,n.partials))),void 0===e&&n&&(e=n),void 0===e)throw new g.default("The partial "+i.name+" could not be found");return e instanceof Function?e(t,i):void 0}function r(){return""}function u(e,t){return t&&"root"in t||(t=t?v.createFrame(t):{},t.root=e),t}function c(e,t,i,n,s,a){if(e.decorator){var o={};t=e.decorator(t,o,i,n&&n[0],s,a,n),m.extend(t,o)}return t}var d=i(1).default,p=i(2).default;t.__esModule=!0,t.checkRevision=n,t.template=s,t.wrapProgram=a,t.resolvePartial=o,t.invokePartial=l,t.noop=r;var f=i(4),m=d(f),h=i(5),g=p(h),v=i(3)},function(e,t){(function(i){t.__esModule=!0,t.default=function(e){var t="undefined"!=typeof i?i:window,n=t.Handlebars;e.noConflict=function(){return t.Handlebars===e&&(t.Handlebars=n),e}},e.exports=t.default}).call(t,function(){return this}())}])}),function(){var e=Handlebars.template,t=Handlebars.templates=Handlebars.templates||{};t._app=e({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,s){var a;return(null!=(a=e.invokePartial(n.visual,t,{name:"visual",data:s,helpers:i,partials:n,decorators:e.decorators}))?a:"")+(null!=(a=e.invokePartial(n.menu,t,{name:"menu",data:s,helpers:i,partials:n,decorators:e.decorators}))?a:"")+(null!=(a=e.invokePartial(n.panel,t,{name:"panel",data:s,helpers:i,partials:n,decorators:e.decorators}))?a:"")+(null!=(a=e.invokePartial(n.grid,t,{name:"grid",data:s,helpers:i,partials:n,decorators:e.decorators}))?a:"")},usePartial:!0,useData:!0}),t.file=e({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,s){var a;return'<a class="sample" draggable="true">\n\t<div class="waveformWrapper">\n\t\t<svg class="waveform" preserveAspectRatio="none"><path/></svg>\n\t</div>\n\t<span class="name text-overflow">\n\t\t<i class="icon fw"></i>\n\t\t<span>'+e.escapeExpression((a=null!=(a=i.name||(null!=t?t.name:t))?a:i.helperMissing,"function"==typeof a?a.call(null!=t?t:{},{name:"name",hash:{},data:s}):a))+"</span>\n\t</span>\n</a>\n"},useData:!0}),t.grid=e({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,s){return'<div id="grid">\n\t<div class="emWrapper">\n\t\t<div class="header">\n\t\t\t<div class="timeline">\n\t\t\t\t<span class="timeArrow icon caret-down"></span>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="trackList">\n\t\t\t<div class="cols">\n\t\t\t\t<div class="colA trackNames">\n\t\t\t\t\t<div class="extend" data-mousemove-fn="trackNames"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class="colB">\n\t\t\t\t\t<div class="trackLinesBg"></div>\n\t\t\t\t\t<div class="trackLines">\n\t\t\t\t\t\t<div class="timeCursor"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n'},useData:!0}),t.historyAction=e({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,s){var a,o;return'<a class="task">\n\t<i class="icon fw circle"></i>\n\t<span class="text">'+(null!=(o=null!=(o=i.desc||(null!=t?t.desc:t))?o:i.helperMissing,a="function"==typeof o?o.call(null!=t?t:{},{name:"desc",hash:{},data:s}):o)?a:"")+"</span>\n</a>\n"},useData:!0}),t.menu=e({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,s){return'<div id="menu">\n\t<a class="btn border icon play" title="Play/pause (press Space, hold Ctrl for pause)"></a>\n\t<a class="btn border icon stop" title="Stop (press Space)"></a>\n\t<div class="bpm border" title="Beats per minute (Scroll to change)">\n\t\t<span class="text">\n\t\t\t<a class="a-bpm">\n\t\t\t\t<i class="icon"></i>\n\t\t\t\t<span class="int"></span>\n\t\t\t\t<span class="dec"></span>\n\t\t\t</a>\n\t\t\t<div class="bpm-list">\n\t\t\t\t<a>80</a><a>90</a><a>100</a>\n\t\t\t\t<a>110</a><a>120</a><a>130</a>\n\t\t\t\t<a>140</a><a>150</a><a>160</a>\n\t\t\t</div>\n\t\t\t<span class="unit">bpm</span>\n\t\t</span>\n\t</div>\n\t<a data-edit="save"     class="btn icon fw save" title="Save"></a>\n\t<a data-option="magnet" class="btn icon fw magnet" title="Toggle magnetism (press G)"></a>\n\t<div class="sep"></div>\n\t<a data-tool="select" class="btn icon fw tool-select" title="Select (hold Shift or press V)"></a>\n\t<a data-tool="paint"  class="btn icon fw tool-paint" title="Paint (press B)"></a>\n\t<a data-tool="delete" class="btn icon fw tool-delete" title="Delete (press D)"></a>\n\t<a data-tool="mute"   class="btn icon fw tool-mute" title="Mute (press M)" style="display: none;"></a>\n\t<a data-tool="slip"   class="btn icon fw tool-slip" title="Slip (press S)"></a>\n\t<a data-tool="cut"    class="btn icon fw tool-cut" title="Cut (press C)"></a>\n\t<a data-tool="hand"   class="btn icon fw tool-hand" title="Hand (hold Alt or press H)"></a>\n\t<a data-tool="zoom"   class="btn icon fw tool-zoom last" title="Zoom (hold Ctrl or press Z)"></a>\n\t<div class="flex1"></div>\n\t<a href=".." target="_blank" class="icon about" title="About"></a>\n</div>\n'},useData:!0}),t["panel-files"]=e({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,s){return'<section id="files">\n\t<input type="file"/>\n\t<nav class="filters">\n\t\t<a href="#" class="used">Used</a>\n\t\t<a href="#" class="loaded">Loaded</a>\n\t\t<a href="#" class="unloaded">Unloaded</a>\n\t</nav>\n\t<div class="filelist"></div>\n\t<div class="placeholder">\n\t\t<i class="icon file-audio"></i><br/>\n\t\t<b>Drop audio files here</b>\n\t</div>\n</section>\n'},useData:!0}),t["panel-history"]=e({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,s){return'<section id="history">\n\t<div class="actionlist"></div>\n</section>\n'},useData:!0}),t.panel=e({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,s){var a;return'<div id="panel">\n\t<div class="extend" data-mousemove-fn="panel"></div>\n'+(null!=(a=e.invokePartial(n["panel-history"],t,{name:"panel-history",data:s,indent:"\t",helpers:i,partials:n,decorators:e.decorators}))?a:"")+(null!=(a=e.invokePartial(n["panel-files"],t,{name:"panel-files",data:s,indent:"\t",helpers:i,partials:n,decorators:e.decorators}))?a:"")+"</div>\n"},usePartial:!0,useData:!0}),t.sample=e({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,s){var a;return'<div class="sample">\n\t<div class="waveformWrapper">\n\t\t<svg class="waveform" preserveAspectRatio="none"><path/></svg>\n\t</div>\n\t<span class="name text-overflow">'+e.escapeExpression((a=null!=(a=i.name||(null!=t?t.name:t))?a:i.helperMissing,"function"==typeof a?a.call(null!=t?t:{},{name:"name",hash:{},data:s}):a))+'</span>\n\t<div class="crop start"></div>\n\t<div class="crop end"></div>\n</div>\n'},useData:!0}),t.visual=e({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,s){return'<div id="visual">\n\t<canvas></canvas>\n\t<div class="columns">\n\t\t<div class="cell-btn"><a class="btn icon fw history" title="History (undo/redo)"></a></div>\n\t\t<div class="cell-btn"><a class="btn icon fw files" title="Audio files"></a></div>\n\t\t<div class="cell-clock">\n\t\t\t<div class="clock">\n\t\t\t\t<span class="min"></span>\n\t\t\t\t<span class="sec"></span>\n\t\t\t\t<span class="ms"></span>\n\t\t\t\t<a class="units" href="#">\n\t\t\t\t\t<span class="s">sec</span>\n\t\t\t\t\t<span class="b">beat</span>\n\t\t\t\t</a>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n'},useData:!0})}(),window.AudioContext=window.AudioContext||window.webkitAudioContext,walContext.prototype={gain:function(e){return arguments.length?(this.filter.gain(e),this):this.filter.gain()},createBuffer:function(e){var t=this;return new Promise(function(i,n){new walContext.Buffer(t,e,i,n)}).then(function(e){return t.buffers.push(e),e})},createFilters:function(){return new walContext.Filters(this)},createComposition:function(){var e=new walContext.Composition(this);return this.compositions.push(e),e}},function(){function e(e){var t,i=null,n=0;e.wSamples.forEach(function(e){t=e.getEndTime(),t>n&&(n=t,i=e)}),e.lastSample=i,e.duration=i?i.getEndTime():0}function t(t){clearTimeout(t.playTimeoutId),e(t);var i=t.duration&&t.duration-t.currentTime();i<=0?t.onended():t.playTimeoutId=setTimeout(t.onended.bind(t),1e3*i)}function i(e,t){var i=e.when-t;e.start(i,i>0?e.offset:e.offset-i,i>0?e.duration:e.duration+i)}function n(e,n,s,a){var o=e.currentTime();n.getEndTime()>o&&"rm"!==s&&(n.load(),i(n,o)),e.lastSample===a&&"mv"!==s||t(e)}function s(e){clearTimeout(e.playTimeoutId),e.wSamples.forEach(function(e){e.stop()})}function a(e){var t=e.currentTime();e.wSamples.forEach(function(e){e.getEndTime()>t&&e.load()})}function o(e){var n=e.currentTime();e.wSamples.forEach(function(e){e.getEndTime()>n&&i(e,n)}),t(e)}walContext.Composition=function(e){this.wCtx=e,this.wSamples=[],this.lastSample=null,this.isPlaying=this.isPaused=!1,this.duration=this.startedTime=this._currentTime=0,this.fnOnended=this.fnOnpaused=function(){}},walContext.Composition.prototype={addSamples:function(e){return e.forEach(function(e){this.wSamples.indexOf(e)<0&&(this.wSamples.push(e),e.composition=this,this.update(e))},this),this},removeSamples:function(e){return e.forEach(function(e){var t=this.wSamples.indexOf(e);t>-1&&(this.wSamples.splice(t,1),e.composition=null,this.update(e,"rm"))},this),this},update:function(t,i){var s,a=this,o=this.lastSample;return e(this),this.isPlaying&&(t.started?(s=t.fnOnended,t.onended(function(){n(a,t,i,o),s(),t.onended(s)}),t.stop()):n(this,t,i,o)),this},currentTime:function(e){return arguments.length?(this.isPlaying&&s(this),this._currentTime=Math.max(0,Math.min(e,this.duration)),this.isPlaying&&(this.startedTime=this.wCtx.ctx.currentTime,a(this),o(this)),this):this._currentTime+(this.isPlaying&&wa.wctx.ctx.currentTime-this.startedTime)},play:function(){return this.isPlaying||(this.isPlaying=!0,this.isPaused=!1,this.startedTime=wa.wctx.ctx.currentTime,a(this),o(this)),this},stop:function(){return(this.isPlaying||this.isPaused)&&(s(this),this.onended()),this},pause:function(){this.isPlaying&&(this.isPlaying=!1,this.isPaused=!0,this._currentTime+=wa.wctx.ctx.currentTime-this.startedTime,this.startedTime=0,s(this),this.fnOnpaused())},onended:function(e){return"function"==typeof e?this.fnOnended=e:(this.isPlaying=this.isPaused=!1,this.startedTime=this._currentTime=0,this.fnOnended()),this}}}(),function(){walContext.Buffer=function(e,t,i,n){function s(e){a.wCtx.ctx.decodeAudioData(e,function(e){a.buffer=e,a.isReady=!0,i(a)},n)}var a=this,o=new FileReader;this.wCtx=e,this.isReady=!1,t.name?(o.addEventListener("loadend",function(){s(o.result)}),o.readAsArrayBuffer(t)):s(t)},walContext.Buffer.prototype={createSample:function(){var e=new walContext.Sample(this.wCtx,this);return e},getPeaks:function(e,t,i,n){i=i||0,n=void 0===n?this.buffer.duration-i:Math.min(n,this.buffer.duration-i);for(var s,a,o,l=0,r=new Array(t),u=this.buffer.getChannelData(e),c=n*this.buffer.sampleRate,d=i*this.buffer.sampleRate,p=c/t,f=~~Math.max(1,p/10);l<t;++l){for(s=d+l*p,a=s+p,o=0;s<a;s+=f)o=Math.max(o,Math.abs(u[~~s]));r[l]=o}return r}}}(),function(){function e(e,t,i){e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3]}function t(t,i,n,s){var a,o,l,r,u=i.data,c=i.width,d=i.height,p=d/2,f=t.getPeaks(0,c),m=t.buffer.numberOfChannels>1?t.getPeaks(1,c):f;if(s){for(a=0;a<u.length;a+=4)e(u,a,n);n=[0,0,0,0]}for(a=0;a<c;++a){for(l=~~(p*(1-f[a])),r=~~(p*(1+m[a])),o=l;o<=r;++o)e(u,4*(o*c+a),n);e(u,4*(p*c+a),n)}return i}walContext.Buffer.prototype.waveformSVG=function(e,t,i,n,s){var a,o=i/2-.5,l=i/2+.5,r="M0 "+o,u=e?e.firstChild:document.createElement("path"),c=this.getPeaks(0,t,n,s),d=this.buffer.numberOfChannels>1?this.getPeaks(1,t,n,s):c;for(e||(e=document.createElement("svg"),e.appendChild(u)),a=0;a<t;++a)r+=" L"+a+" "+(o-c[a]*o);for(a=t-1;a>=0;--a)r+=" L"+a+" "+(l+d[a]*o);return u.setAttribute("d",r),e.setAttribute("viewBox","0 0 "+t+" "+i),e},walContext.Buffer.prototype.drawWaveform=function(e,i){return t(this,e,i)},walContext.Buffer.prototype.drawInvertedWaveform=function(e,i){return t(this,e,i,!0)}}(),walContext.Filters=function(e){this.wCtx=e,this.nodes=[],this.nodeIn=e.ctx.createGain(),this.nodeOut=e.ctx.createGain(),this.nodeIn.connect(this.nodeOut),this.connect(e)},walContext.Filters.prototype={connect:function(e){e=e.nodeIn||e,e instanceof AudioNode&&(this.connectedTo=e,this.nodeOut.connect(e))},disconnect:function(){this.nodeOut.disconnect(),this.connectedTo=null},empty:function(){this.nodes.length&&(this.nodes[this.nodes.length-1].disconnect(),this.nodeIn.disconnect(),this.nodeIn.connect(this.nodeOut),this.nodes=[])},gain:function(e){return arguments.length?void(this.nodeOut.gain.value=e):this.nodeOut.gain.value},pushBack:function(e){if(this.nodes.length){var t=this.nodes[this.nodes.length-1];t.disconnect(),t.connect(e)}else this.nodeIn.disconnect(),this.nodeIn.connect(e);e.connect(this.nodeOut),this.nodes.push(e)},pushFront:function(e){this.nodes.length?(this.nodeIn.disconnect(),this.nodeIn.connect(e),e.connect(this.nodes[0]),this.nodes.unshift(e)):this.pushBack(e)},popBack:function(){var e=this.nodes.pop();if(e)if(e.disconnect(),this.nodes.length){var t=this.nodes[this.nodes.length-1];t.disconnect(),t.connect(this.nodeOut)}else this.nodeIn.disconnect(),this.nodeIn.connect(this.nodeOut);return e},popFront:function(){var e=this.nodes.shift();return e&&(e.disconnect(),this.nodeIn.disconnect(),this.nodeIn.connect(this.nodes[0]||this.nodeOut)),e}},walContext.Sample=function(e,t,i){this.wCtx=e,this.wBuffer=t,this.connectedTo=i?i.nodeIn:e.nodeIn,this.when=this.offset=0,this.duration=this.bufferDuration=t.buffer.duration,this.fnOnended=function(){},this.loaded=this.started=this.playing=!1},walContext.Sample.prototype={connect:function(e){return e=e.nodeIn||e,e instanceof AudioNode&&(this.connectedTo=e,this.source&&this.source.connect(e)),this},disconnect:function(){return this.source&&(this.source.disconnect(),this.connectedTo=null),this},load:function(){return this.loaded||(this.loaded=!0,this.source=this.wCtx.ctx.createBufferSource(),this.source.buffer=this.wBuffer.buffer,this.source.onended=this.onended.bind(this),this.connectedTo&&this.source.connect(this.connectedTo)),this},start:function(e,t,i){function n(){++s.wCtx.nbPlaying,s.playing=!0}if(this.loaded)if(this.started)console.warn("WebAudio Library: can not start a sample twice.");else{var s=this;this.started=!0,e=void 0!==e?e:this.when,this.source.start(this.wCtx.ctx.currentTime+e,void 0!==t?t:this.offset,void 0!==i?i:this.duration),e?this.playTimeoutId=setTimeout(n,1e3*e):n()}else console.warn("WebAudio Library: can not start an unloaded sample.");return this},stop:function(){return this.started&&(this.source.onended=null,this.source.stop(0),this.onended()),this},getEndTime:function(){return this.when+this.duration},onended:function(e){return"function"==typeof e?this.fnOnended=e:this.loaded&&(this.playing&&(this.playing=!1,--this.wCtx.nbPlaying),this.started&&(this.started=!1,clearTimeout(this.playTimeoutId)),this.loaded=!1,this.source=null,this.fnOnended()),this}},function(){function e(t){for(var i,n=t.firstChild;null!==n;)e(i=n),n=n.nextSibling,1!==i.nodeType&&/^\s*$/.test(i.textContent)&&t.removeChild(i)}var t,i=Handlebars.templates,n=wisdom.qS,s=wisdom.qSA;window.ui={},ui.elApp=n("#app");for(t in i)"_app"!==t&&Handlebars.registerPartial(t,i[t]);ui.elApp.innerHTML=Handlebars.templates._app({}),e(document.body),ui.tool={},ui.tracks=[],ui.nbTracksOn=0,ui.elVisual=n("#visual"),ui.elVisualCanvas=n(ui.elVisual,"canvas"),ui.elClockUnits=n(ui.elVisual,".clock .units"),ui.elClockMin=n(ui.elVisual,".clock > .min"),ui.elClockSec=n(ui.elVisual,".clock > .sec"),ui.elClockMs=n(ui.elVisual,".clock > .ms"),ui.elBtnHistory=n(ui.elVisual,".btn.history"),ui.elBtnFiles=n(ui.elVisual,".btn.files"),ui.elMenu=n("#menu"),ui.elPlay=n(ui.elMenu,".btn.play"),ui.elStop=n(ui.elMenu,".btn.stop"),ui.elBpm=n(ui.elMenu,".bpm"),ui.elBpmA=n(ui.elMenu,".bpm .a-bpm"),ui.elBpmInt=n(ui.elMenu,".bpm .int"),ui.elBpmDec=n(ui.elMenu,".bpm .dec"),ui.elBpmList=n(ui.elMenu,".bpm-list"),ui.elBtnMagnet=n(ui.elMenu,".btn.magnet"),ui.elBtnSave=n(ui.elMenu,".btn.save"),ui.elToolBtns=s(ui.elMenu,".btn[data-tool]"),ui.elPanel=n("#panel"),ui.elHistoryActionList=n(ui.elPanel,".actionlist"),ui.elInputFile=n(ui.elPanel,"input[type='file']"),ui.elFileFilters=n(ui.elPanel,".filters"),ui.elFilelist=n(ui.elPanel,".filelist"),ui.elGrid=n("#grid"),ui.elGridEm=n(ui.elGrid,".emWrapper"),ui.elGridHeader=n(ui.elGrid,".header"),ui.elTimeline=n(ui.elGrid,".timeline"),ui.elTimeArrow=n(ui.elGrid,".timeArrow"),ui.elTimeCursor=n(ui.elGrid,".timeCursor"),ui.elTrackList=n(ui.elGrid,".trackList"),ui.elGridCols=n(ui.elGrid,".cols"),ui.elGridColB=n(ui.elGrid,".colB"),ui.elTrackNames=n(ui.elGrid,".trackNames"),ui.elTrackLines=n(ui.elGrid,".trackLines"),ui.elTrackLinesBg=n(ui.elGrid,".trackLinesBg"),ui.gridEm=parseFloat(getComputedStyle(ui.elGrid).fontSize),ui.gridColsY=ui.elGridCols.getBoundingClientRect().top,ui.elVisualCanvas.width=256,ui.elVisualCanvas.height=ui.elVisualCanvas.clientHeight}(),function(){function e(){var a=i;wa.wctx.nbPlaying&&(a=wa.analyserArray,wa.analyser.getByteTimeDomainData(a)),wa.oscilloscope(n,s,a),t=requestAnimationFrame(e)}var t,i=[],n=ui.elVisualCanvas,s=n.getContext("2d");ui.analyserEnabled=!1,ui.analyserToggle=function(i){"boolean"!=typeof i&&(i=!ui.analyserEnabled),ui.analyserEnabled=i,i?t=requestAnimationFrame(e):(s.clearRect(0,0,n.width,n.height),
cancelAnimationFrame(t))}}(),ui.BPMem=1,ui.bpm=function(e){var t=~~e,i=Math.min(Math.round(100*(e-t)),99);ui.BPMem=e/60,ui.elBpmInt.textContent=t<100?"0"+t:t,ui.elBpmDec.textContent=i<10?"0"+i:i},ui.setClockUnit=function(e){ui.elClockUnits.dataset.unit=e,ui.currentTime(gs.currentTime())},function(){function e(e){if(e>0){var t=e*ui.BPMem+"em";wisdom.css(ui.elTimeCursor,"left",t),wisdom.css(ui.elTimeArrow,"left",t)}ui.elTimeCursor.classList.toggle("visible",e>0),ui.elTimeArrow.classList.toggle("visible",e>0)}function t(e){var t,i,n;"s"===gs.clockUnit?(t=~~(e/60),i=~~(e%60)):(e*=ui.BPMem,t=1+~~e,e*=4,i=1+~~e%4),i=i<10?"0"+i:i,n=Math.floor(1e3*(e-~~e)),n<10?n="00"+n:n<100&&(n="0"+n),ui.elClockMin.textContent=t,ui.elClockSec.textContent=i,ui.elClockMs.textContent=n}ui.currentTime=function(i){e(i),t(i)}}(),function(){function e(e,t){t?e.dataset.cursor=t:e.removeAttribute("data-cursor")}var t=null;ui.cursor=function(i,n){"app"===i?(e(ui.elApp,n),e(ui.elTrackLines,n?null:t)):e(ui.elTrackLines,t=n)}}(),function(){function e(e,t){return Math.abs(e-t)<1e-4}function t(e){var t=e%i;return e-=t,t>n&&(e+=i),e}ui.getGridSec=function(e){var i=(e-ui.filesWidth-ui.trackNamesWidth-ui.trackLinesLeft)/ui.gridEm;return(ui.isMagnetized?t(i):i)/ui.BPMem},ui.secFloor=function(n){var s=n*ui.BPMem,a=t(s);return(a<s||e(a,s)?a:a-i)/ui.BPMem},ui.secCeil=function(n){var s=n*ui.BPMem,a=t(s);return(a>s||e(a,s)?a:a+i)/ui.BPMem};var i=.25,n=i/2}(),ui.getTrackFromPageY=function(e){return ui.tracks[Math.floor((e-ui.gridColsY+ui.gridScrollTop)/ui.gridEm)]},ui.CSS_fileUnloaded=function(e){e.elIcon.classList.add("ramload"),e.elIcon.classList.remove("question"),e.elFile.classList.add("unloaded")},ui.CSS_fileWithoutData=function(e){e.elIcon.classList.add("question"),e.elIcon.classList.remove("ramload"),e.elFile.classList.add("unloaded")},ui.CSS_fileLoading=function(e){e.elIcon.classList.add("loading"),e.elIcon.classList.remove("ramload")},ui.CSS_fileLoaded=function(e){e.elFile.classList.add("loaded"),e.elFile.classList.remove("unloaded"),e.elIcon.remove()},ui.CSS_fileError=function(e){e.elIcon.classList.add("cross"),e.elIcon.classList.remove("loading")},ui.CSS_fileUsed=function(e){e.elFile.classList.add("used")},ui.CSS_fileUnused=function(e){e.elFile.classList.remove("used")},function(){ui.historyReset=function(){for(e=0,t=[];ui.elHistoryActionList.hasChildNodes();)ui.elHistoryActionList.lastChild.remove()},ui.historyPush=function(i){for(var n=t.length-e,s=wisdom.cE(Handlebars.templates.historyAction(i))[0];n-- >0;)ui.elHistoryActionList.lastChild.remove(),t.pop();s.historyAction=i,s.historyIndex=e++,ui.elHistoryActionList.appendChild(s),t.push(s)},ui.historyGo=function(i){if(i<0)for(;i++<0;)t[--e].classList.add("undone");else if(i>0)for(;i-- >0;)t[e++].classList.remove("undone")};var e,t}(),ui.newTrack=function(){ui.tracks.push(new ui.Track(this))},ui.panelSection=function(e){ui.elApp.dataset.panel=e},function(){function e(){ui.currentTime(wa.composition.currentTime()),t=requestAnimationFrame(e)}var t;ui.play=function(){ui.elPlay.classList.remove("play"),ui.elPlay.classList.add("pause"),e()},ui.pause=function(){cancelAnimationFrame(t),ui.elPlay.classList.remove("pause"),ui.elPlay.classList.add("play")},ui.stop=function(){ui.pause(),ui.currentTime(0)}}(),ui.resize=function(){ui.screenWidth=document.body.clientWidth,ui.screenHeight=document.body.clientHeight,ui.gridColsWidth=ui.elGridCols.getBoundingClientRect().width,ui.gridColsHeight=ui.elTrackList.clientHeight,ui.trackLinesWidth=ui.gridColsWidth-ui.trackNamesWidth,ui.updateTimeline(),ui.updateTrackLinesBg()},ui.CSS_sampleTrack=function(e){e.track.elColLinesTrack.appendChild(e.elSample)},ui.CSS_sampleWhen=function(e){wisdom.css(e.elSample,"left",e.wsample.when*ui.BPMem+"em")},ui.CSS_sampleSelect=function(e){e.elSample.classList.toggle("selected",e.selected)},ui.CSS_sampleDelete=function(e){e.elSample.remove()},ui.CSS_sampleOffset=function(e){ui.CSS_sampleWaveform(e)},ui.CSS_sampleDuration=function(e){wisdom.css(e.elSample,"width",e.wsample.duration*ui.BPMem+"em"),ui.CSS_sampleWaveform(e)},ui.CSS_sampleWaveform=function(e){var t=e.wsample.offset,i=Math.min(e.wsample.duration,e.wsample.bufferDuration-t),n=i*ui.BPMem;wisdom.css(e.elSVG,"width",n+"em"),e.wsample.wBuffer.waveformSVG(e.elSVG,~~(50*n),50,t,i)},ui.selectTool=function(){var e;return function(t){var i,n=ui.elToolBtns.tool[t];n!==e&&(e&&(e.classList.remove("active"),i=ui.tool[ui.currentTool],i.mouseup&&i.mouseup({}),i.end&&i.end()),e=n,n.classList.add("active"),ui.elGrid.dataset.tool=ui.currentTool=t,i=ui.tool[t],i.start&&i.start())}}(),ui.setFilesWidth=function(e){wisdom.css(ui.elPanel,"width",e+"px"),ui.filesWidth=e=ui.elPanel.clientWidth,ui.gridColsWidth=ui.screenWidth-e,ui.trackLinesWidth=ui.gridColsWidth-ui.trackNamesWidth,wisdom.css(ui.elGrid,"left",e+"px"),wisdom.css(ui.elVisual,"width",e+ui.trackNamesWidth+"px"),wisdom.css(ui.elMenu,"left",e+ui.trackNamesWidth+"px"),ui.updateTimeline(),ui.updateTrackLinesBg()},ui.gridScrollTop=0,ui.setGridScrollTop=function(e){ui.elGridCols.scrollTop=ui.gridScrollTop=e<=0?0:Math.min(e,ui.tracks.length*ui.gridEm-ui.gridColsHeight),ui.updateGridTopShadow()},ui.gridZoom=1,ui.setGridZoom=function(e,t,i){e=Math.min(Math.max(1,e),8);var n=e/ui.gridZoom;ui.gridZoom=e,ui.gridEm*=n,wisdom.css(ui.elGridEm,"fontSize",e+"em"),ui.elGrid.dataset.sampleSize=ui.gridEm<40?"small":ui.gridEm<80?"medium":"big",ui.setGridScrollTop(-(i-(ui.gridScrollTop+i)*n)),ui.setTrackLinesLeft(t-(-ui.trackLinesLeft+t)*n),ui.updateTimeline(),ui.updateTrackLinesBg()},ui.setTrackLinesLeft=function(e){ui.trackLinesLeft=e=Math.min(~~e,0),wisdom.css(ui.elTrackLines,"marginLeft",e/ui.gridEm+"em"),ui.updateGridLeftShadow()},ui.trackNamesWidth=0,ui.setTrackNamesWidth=function(e){var t,i=ui.trackNamesWidth;wisdom.css(ui.elTrackNames,"width",e+"px"),ui.trackNamesWidth=e=ui.elTrackNames.getBoundingClientRect().width,ui.trackLinesWidth=ui.gridColsWidth-e,t=ui.filesWidth+e,wisdom.css(ui.elGridColB,"left",e+"px"),wisdom.css(ui.elTimeline,"left",e+"px"),wisdom.css(ui.elVisual,"width",t+"px"),wisdom.css(ui.elMenu,"left",t+"px"),ui.trackLinesLeft<0&&ui.setTrackLinesLeft(ui.trackLinesLeft-(e-i)),ui.updateTimeline(),ui.updateTrackLinesBg()},ui.isMagnetized=!1,ui.toggleMagnetism=function(e){"boolean"!=typeof e&&(e=!ui.isMagnetized),ui.isMagnetized=e,ui.elBtnMagnet.classList.toggle("active",e)},ui.toggleTracks=function(e){for(var t,i=0,n=e.isOn&&1===ui.nbTracksOn;t=ui.tracks[i++];)t.toggle(n);e.toggle(!0)},function(){var e=2,t="rgba(0,0,0,.3)",i="px "+e+"px "+t;ui.updateGridLeftShadow=function(){var e=-ui.trackLinesLeft;wisdom.css(ui.elTrackNames,"boxShadow",e?Math.min(2+e/8,5)+"px 0"+i:"none")},ui.updateGridTopShadow=function(){var e=ui.gridScrollTop;wisdom.css(ui.elGridHeader,"boxShadow",e?"0px "+Math.min(2+e/8,5)+i:"none")}}(),function(){function e(e){if(e>i){var n,s=i;for(i=e;s++<e;)n=document.createElement("div"),n.appendChild(document.createElement("span")),ui.elTimeline.appendChild(n),t=t||n}}var t,i=0;ui.updateTimeline=function(){var i=ui.trackLinesLeft/ui.gridEm,n=ui.trackLinesWidth/ui.gridEm;e(Math.ceil(-i+n)),wisdom.css(t,"marginLeft",i+"em"),wisdom.css(ui.elTimeArrow,"marginLeft",i+"em")}}(),function(){function e(e){var n,s,a,o,l,r=e-i;for(i=Math.max(e,i),n=0;n<r;++n){for(o=document.createElement("div"),s=0;s<4;++s){for(l=document.createElement("div"),a=0;a<4;++a)l.appendChild(document.createElement("div"));o.appendChild(l)}ui.elTrackLinesBg.appendChild(o)}t=t||ui.elTrackLinesBg.firstChild}var t,i=0;ui.updateTrackLinesBg=function(){e(Math.ceil(ui.trackLinesWidth/ui.gridEm/4)+2),wisdom.css(t,"marginLeft",ui.trackLinesLeft/ui.gridEm%8+"em")}}(),ui.Track=function(e,t){t=t||{},this.grid=e,this.id=ui.tracks.length,this.elColNamesTrack=wisdom.cE("<div class='track'>")[0],this.elColLinesTrack=wisdom.cE("<div class='track'>")[0],ui.elTrackNames.appendChild(this.elColNamesTrack),ui.elTrackLines.appendChild(this.elColLinesTrack),this.elColNamesTrack.uitrack,this.elColLinesTrack.uitrack=this,this.wfilters=wa.wctx.createFilters(),this.samples=[],this.initToggle().initEditName().toggle(t.toggle!==!1).editName(t.name||"")},ui.Track.prototype={removeSample:function(e){var t=this.samples.indexOf(e);t>=0&&this.samples.splice(t,1)}},ui.Track.prototype.initEditName=function(){var e=this;return this.elName=wisdom.cE("<span class='name text-overflow'>")[0],this.elName.ondblclick=this.editName.bind(this,!0),this.elColNamesTrack.appendChild(this.elName),this.elNameInput=wisdom.cE("<input type='text'/>")[0],this.elColNamesTrack.appendChild(this.elNameInput),this.elNameInput.onblur=function(){e.editName(this.value).editName(!1)},this.elNameInput.onkeydown=function(t){13!==t.keyCode&&27!==t.keyCode||e.editName(13===t.keyCode?this.value:e.name).editName(!1),t.stopPropagation()},this},ui.Track.prototype.editName=function(e){var t=this.elNameInput,i="Track "+(this.id+1);return"string"==typeof e?(e=e.replace(/^\s+|\s+$/,"").replace(/\s+/g," "),e=e===i?"":e,this.elName.classList.toggle("empty",""===e),this.elName.textContent=e||i,this.name=e):e?(this.elColNamesTrack.classList.add("editing"),t.value=this.name||i,t.focus(),t.select()):(t.blur(),this.elColNamesTrack.classList.remove("editing")),this},ui.Track.prototype.initToggle=function(){var e=this;return this.elToggle=wisdom.cE("<a class='toggle icon circle'>")[0],this.elColNamesTrack.appendChild(this.elToggle),this.elToggle.oncontextmenu=function(){return!1},this.elToggle.onmousedown=function(t){0===t.button?e.toggle():2===t.button&&ui.toggleTracks(e)},this},ui.Track.prototype.toggle=function(e){return"boolean"!=typeof e&&(e=!this.isOn),this.isOn!==e&&(this.wfilters.gain(+e),this.isOn=e,this.grid.nbTracksOn+=e?1:-1,this.elToggle.classList.toggle("on",e),this.elColNamesTrack.classList.toggle("off",!e),this.elColLinesTrack.classList.toggle("off",!e)),this},function(){var e=new walContext,t=e.ctx.createAnalyser();t.fftSize=256,e.filters.pushBack(t),window.wa={wctx:e,ctx:e.ctx,analyser:t,analyserArray:new Uint8Array(t.frequencyBinCount),composition:e.createComposition()}}(),wa.oscilloscope=function(){var e=0,t=Math.PI/2;return function(i,n,s){var a,o=0,l=i.width,r=i.height,u=s.length,c=u/2,d=l/(u-1);for(n.globalCompositeOperation="source-in",n.fillStyle="rgba("+Math.round(255-255*e)+","+Math.round(64*e)+","+Math.round(255*e)+","+(.95-.25*(1-Math.cos(e*t)))+")",n.fillRect(0,0,l,r),e=0,n.globalCompositeOperation="source-over",n.save(),n.translate(0,r/2),n.beginPath(),n.moveTo(0,0);o<u;++o)a=(s[o]-128)/128,e=Math.max(Math.abs(a),e),a*=.5-Math.cos((o<c?o:u-o)/c*Math.PI)/2,n.lineTo(o*d,a*r);n.lineJoin="round",n.lineWidth=1+Math.round(2*e),n.strokeStyle="rgba(255,255,255,"+Math.min(.3+4*e,1)+")",n.stroke(),n.restore()}}(),window.gs={files:[],samples:[],selectedSamples:[]},gs.bpm=function(e){if(!arguments.length)return gs._bpm;var t,i=ui.BPMem,n=gs.currentTime()*i;gs._bpm=Math.max(20,Math.min(e,999)),ui.bpm(gs._bpm),t=i/ui.BPMem,gs.samples.forEach(function(e){e.wsample?(e.wsample.when=e.wsample.when*t,ui.CSS_sampleDuration(e),ui.CSS_sampleOffset(e)):(e.savedWhen=e.savedWhen*t,wisdom.css(e.elSample,"width",e.savedDuration*ui.BPMem+"em"))}),gs.currentTime(n/ui.BPMem)},gs.currentTime=function(e){return arguments.length?(wa.composition.currentTime(e),void ui.currentTime(wa.composition.currentTime())):wa.composition.currentTime()},gs.playStop=function(){(gs.isPlaying?gs.stop:gs.play)()},gs.playPause=function(){(wa.composition.isPlaying?gs.pause:gs.play)()},gs.play=function(){gs.fileStop(),!wa.composition.isPlaying&&wa.composition.wSamples.length&&gs.samples.length&&(wa.composition.play(),wa.composition.isPlaying&&(gs.isPaused=!(gs.isPlaying=!0),ui.play()))},gs.pause=function(){gs.fileStop(),wa.composition.isPlaying&&(wa.composition.pause(),gs.isPaused=!(gs.isPlaying=!1),ui.pause())},gs.stop=function(){gs.fileStop(),gs.compositionStop()},gs.compositionStop=function(){wa.composition.stop(),gs.currentTime(0),gs.isPaused=gs.isPlaying=!1,ui.stop()},function(){function e(e,t){var i=JSON.parse(t.target.result);gs.bpm(i.bpm),i.files.forEach(function(e){var t=gs.fileCreate(e);t.samplesToSet=[]}),i.tracks.forEach(function(e){for(var t=e[0];t>=ui.tracks.length;)ui.newTrack();ui.tracks[t].toggle(e[1]).editName(e[2])}),i.samples.forEach(function(e){6===e.length&&e.splice(0,1);var t=gs.sampleCreate(gs.files[e[1]]);t.gsfile.samplesToSet.push(t),t.savedWhen=e[2],t.savedOffset=e[3],t.savedDuration=e[4],t.track=ui.tracks[e[0]],t.track.samples.push(t),ui.CSS_sampleTrack(t),wisdom.css(t.elSample,"left",e[2]*ui.BPMem+"em"),wisdom.css(t.elSample,"width",e[4]*ui.BPMem+"em")}),e()}gs.load=function(t){return new Promise(function(i,n){if(t){var s=new FileReader;s.onload=e.bind(null,i),s.readAsText(t)}else i()})}}(),gs.save=function(){var e={bpm:this._bpm,files:[],samples:[],tracks:[]};return gs.files.forEach(function(t){e.files.push([t.id,t.fullname,t.file?t.file.size:t.size])}),gs.samples.forEach(function(t){e.samples.push([t.track.id,t.gsfile.id,t.wsample?t.wsample.when:t.savedWhen,t.wsample?t.wsample.offset:t.savedOffset,t.wsample?t.wsample.duration:t.savedDuration])}),ui.tracks.forEach(function(t){(t.isOn||t.samples.length||t.name||t.wfilters&&t.wfilters.length)&&e.tracks.push([t.id,t.isOn,t.name])}),{href:"data:text/plain;charset=utf-8,"+encodeURIComponent(JSON.stringify(e)),download:"s.txt"}},gs.reset=function(){return ui.tracks.forEach(function(e){e.editName(""),e.toggle(!0)}),gs.samples.forEach(function(e){gs.sampleSelect(e,!0)}),gs.samplesDelete(),gs.files.forEach(function(e){e.elFile.remove()}),gs.files=[],this},gs.fileCreate=function(e){var t=new gs.File(e);return t.id=gs.files.length,gs.files.push(t),ui.elFilelist.appendChild(t.elFile),t},gs.fileDelete=function(e){var t=gs.samples.filter(function(t){return t.gsfile===e});t.forEach(function(e){gs.sampleDelete(e)}),gs.files.splice(gs.files.indexOf(e),1),e.delete()},function(){var e,t=wisdom.cE("<div class='cursor'>")[0];gs.filePlay=function(i){e&&e.stop(),i.isLoaded&&(wisdom.css(t,"transitionDuration",0),wisdom.css(t,"left",0),i.elWaveformWrap.appendChild(t),e=i.wbuff.createSample().onended(gs.fileStop).load().start(),setTimeout(function(){wisdom.css(t,"transitionDuration",i.wbuff.buffer.duration+"s"),wisdom.css(t,"left","100%")},20))},gs.fileStop=function(){e&&(e.stop(),t.remove())}}(),function(){var e;ui.elInputFile.onchange=function(){e&&(e.joinFile(this.files[0]),e=null)},gs.File=function(t){var i=this;this.isLoaded=this.isLoading=!1,this.file=t.length?null:t,this.fullname=t.name||t[1],this.name=this.fullname.replace(/\.[^.]+$/,""),this.nbSamples=0,this.elFile=wisdom.cE(Handlebars.templates.file(this))[0],this.elName=wisdom.qS(this.elFile,".name"),this.elIcon=wisdom.qS(this.elFile,".icon"),this.file?ui.CSS_fileUnloaded(this):(this.size=t[2],ui.CSS_fileWithoutData(this)),this.elFile.oncontextmenu=function(){return!1},this.elFile.ondragstart=this.dragstart.bind(this),this.elFile.onmousedown=function(e){0!==e.button&&gs.fileStop(),e.ctrlKey&&gs.fileDelete(i)},this.elFile.onclick=function(){i.isLoaded?gs.filePlay(i):i.file?i.isLoading||i.load(gs.filePlay):(alert("Choose the file to associate or drag and drop "+i.name),e=i,ui.elInputFile.click())}}}(),gs.File.prototype.delete=function(){this.elFile.remove()},function(){document.body.addEventListener("mousemove",function(i){e&&(wisdom.css(t,"left",i.pageX+"px"),wisdom.css(t,"top",i.pageY+"px"))}),document.body.addEventListener("mouseup",function(i){if(e){var n=ui.getTrackFromPageY(i.pageY),s=ui.getGridSec(i.pageX);t.remove(),n&&s>=0&&gs.sampleCreate(e,n.id,s),e=null,ui.cursor("app",null)}}),gs.File.prototype.dragstart=function(i){return this.isLoaded&&!e&&(e=this,t=this.elSVG.cloneNode(!0),wisdom.css(t,"left",i.pageX+"px"),wisdom.css(t,"top",i.pageY+"px"),t.classList.add("dragging"),document.body.appendChild(t),ui.cursor("app","grabbing")),!1};var e,t}(),gs.File.prototype.joinFile=function(e){this.file=e,ui.CSS_fileUnloaded(this),this.fullname!==e.name&&(this.fullname=e.name,this.name=this.fullname.replace(/\.[^.]+$/,""),this.elName.textContent=this.name),this.samplesToSet.length&&this.load(function(e){e.samplesToSet.forEach(function(t){t.wsample=e.wbuff.createSample(),t.when(t.savedWhen),t.slip(t.savedOffset),t.duration(t.savedDuration),t.wsample.connect(t.track.wfilters),wa.composition.addSamples([t.wsample]),t.elName.textContent=e.name,ui.CSS_sampleDuration(t),ui.CSS_sampleWaveform(t)})})},gs.File.prototype.load=function(e){var t=this;this.isLoading=!0,ui.CSS_fileLoading(this),wa.wctx.createBuffer(this.file).then(function(i){t.wbuff=i,t.isLoaded=!0,t.isLoading=!1,t.elSVG=wisdom.qS(t.elFile,"svg"),t.elWaveformWrap=t.elSVG.parentNode,i.waveformSVG(t.elSVG,400,50),ui.CSS_fileLoaded(t),e(t)},function(){t.isLoading=!1,ui.CSS_fileError(t),alert('At this day, the file: "'+t.fullname+'" can not be decoded by your browser.\n')})},function(){gs.history={push:function(i){t<e.length-1&&e.splice(t+1),e.push(i),++t},undo:function(){if(t>0){var i=e[t].undo;i.func&&i.func(i),--t}},redo:function(){if(t<e.length-1){var i=e[++t].action;i.func&&i.func(i)}}};var e=[{}],t=0}(),function(){function e(e){e.samples.forEach(function(e){wa.composition.addSamples([e.wsample]),gs.samples.push(e),ui.CSS_sampleCreate(e),e.inTrack(e.oldTrack.id),e.when(e.wsample.when),e.duration(e.wsample.duration),e.slip(e.wsample.offset),gs.sampleSelect(e,e.oldSelected),e.gsfile.nbSamples++||ui.CSS_fileUsed(e.gsfile)})}function t(e){e.samples.forEach(function(e){gs.samplesDelete(e)})}function i(e){var t,i=1/0;gs.samplesWhen(e.sample,e.whenDiff),e.changeTrack&&(e.sample.selected?(t=e.trackId-e.sample.track.id,t<0&&(gs.selectedSamples.forEach(function(e){i=Math.min(e.track.id,i)}),t=-Math.min(i,-t)),gs.selectedSamples.forEach(function(e){e.inTrack(e.track.id+t)})):e.sample.inTrack(e.trackId)),gs.samplesForEach(e.sample,function(e){wa.composition.update(e.wsample,"mv")})}function n(e){gs.samplesDuration(e.sample,-e.durationDiff),gs.samplesWhen(e.sample,e.whenDiff),gs.samplesSlip(e.sample,-e.offset),gs.samplesForEach(e.sample,function(e){wa.composition.update(e.wsample,"mv")})}function s(e){gs.samplesDuration(e.sample,-e.durationDiff),gs.samplesForEach(e.sample,function(e){wa.composition.update(e.wsample,"mv")})}function a(e){gs.samplesSlip(e.sample,e.offsetDiff),gs.samplesForEach(e.sample,function(e){wa.composition.update(e.wsample,"mv")})}gs.history.select=function(e){var t=e.samples,i=e.removedSamples;i&&i.length>0&&gs.samplesUnselect(),t&&t.forEach(function(e){gs.sampleSelect(e,!e.selected)})},gs.history.undoSelect=function(e){var t=e.samples,i=e.removedSamples;t&&t.length>0?(gs.samplesUnselect(),t.forEach(function(e){gs.sampleSelect(e,!e.selected)})):i&&i.forEach(function(e){gs.sampleSelect(e,!e.selected)})},gs.history.insertSample=function(t){e(t)},gs.history.undoInsertSample=function(e){t(e)},gs.history.removeSample=function(e){t(e)},gs.history.undoRemoveSample=function(t){e(t)},gs.history.moveX=function(e){i(e)},gs.history.undoMoveX=function(e){i(e)},gs.history.crop=function(e){n(e)},gs.history.undoCrop=function(e){n(e)},gs.history.endCrop=function(e){s(e)},gs.history.undoEndCrop=function(e){s(e)},gs.history.slip=function(e){a(e)},gs.history.undoSlip=function(e){a(e)}}(),gs.sampleCreate=function(e,t,i){var n=new gs.Sample(e,t,i);return gs.samples.push(n),ui.CSS_fileUsed(e),++e.nbSamples,n},gs.sampleSelect=function(e,t){e&&e.wsample&&e.selected!==t&&(e.select(t),t?gs.selectedSamples.push(e):gs.selectedSamples.splice(gs.selectedSamples.indexOf(e),1))},gs.sampleDelete=function(e){e&&e.wsample&&(gs.sampleSelect(e,!1),gs.samples.splice(gs.samples.indexOf(e),1),--e.gsfile.nbSamples||ui.CSS_fileUnused(e.gsfile),e.delete())},gs.samplesForEach=function(e,t){e&&e.wsample&&(e.selected?gs.selectedSamples.forEach(function(e){e.wsample&&t(e)}):t(e))},function(){gs.samplesCopy=function(){var i=1/0,n=-(1/0);t=gs.selectedSamples.map(function(e){return i=Math.min(i,e.wsample.when),n=Math.max(n,e.wsample.when+e.wsample.duration),e}),ui.isMagnetized&&(i=ui.secFloor(i),n=ui.secCeil(n)),e=n-i},gs.samplesPaste=function(){gs.samplesUnselect(),t.forEach(function(t){var i=gs.sampleCreate(t.gsfile,t.track.id,t.wsample.when+e);i.slip(t.wsample.offset),i.duration(t.wsample.duration),gs.sampleSelect(i,!0)}),gs.samplesCopy()};var e,t=[]}(),gs.samplesCut=function(e,t){if(e.wsample){var i=t-e.wsample.when;gs.samplesForEach(e,function(e){e.cut(i)})}},gs.samplesDelete=function(){gs.selectedSamples.slice(0).forEach(gs.sampleDelete),gs.selectedSamples=[]},gs.samplesDuration=function(e,t){function i(e){n=Math.min(n,e.wsample.duration),t=Math.min(t,e.wsample.bufferDuration-e.wsample.duration)}var n=1/0;return e.wsample&&(e.selected?gs.selectedSamples.forEach(i):i(e),t<0&&(t=-Math.min(n,-t)),gs.samplesForEach(e,function(e){e.duration(e.wsample.duration+t)})),t},gs.samplesWhen=function(e,t){return e.wsample?(t<0&&(t=-Math.min(-t,e.selected?gs.selectedSamples.reduce(function(e,t){return Math.min(e,t.wsample.when)},1/0):e.wsample.when)),gs.samplesForEach(e,function(e){e.wsample&&e.when(Math.max(0,e.wsample.when+t))}),t):0},gs.samplesSlip=function(e,t){return e.wsample?(t=t<0?-Math.min(-t,e.selected?gs.selectedSamples.reduce(function(e,t){return Math.min(e,t.wsample.bufferDuration-t.wsample.offset)},1/0):e.wsample.bufferDuration-e.wsample.offset):Math.min(t,e.selected?gs.selectedSamples.reduce(function(e,t){return Math.min(e,t.wsample.offset)},1/0):e.wsample.offset),gs.samplesForEach(e,function(e){e.slip(e.wsample.offset-t)}),t):0},gs.samplesCropEnd=gs.samplesDuration,gs.samplesCropStart=function(e,t){return t=-gs.samplesDuration(e,-t),t&&(gs.samplesWhen(e,t),gs.samplesSlip(e,-t)),t},gs.samplesUnselect=function(){gs.selectedSamples.forEach(function(e){e.select(!1)}),gs.selectedSamples=[]},gs.Sample=function(e,t,i){this.gsfile=e,this.elSample=wisdom.cE(Handlebars.templates.sample(e))[0],this.elSVG=wisdom.qS(this.elSample,"svg"),this.elName=wisdom.qS(this.elSample,".name"),this.elCropStart=wisdom.qS(this.elSample,".crop.start"),this.elCropEnd=wisdom.qS(this.elSample,".crop.end"),wisdom.qSA(this.elSample,"*").forEach(function(e){e.gsSample=this},this),e.file&&(this.wsample=e.wbuff.createSample(),this.inTrack(t),this.when(i),ui.CSS_sampleDuration(this),ui.CSS_sampleWaveform(this),wa.composition.addSamples([this.wsample])),this.select(!1)},gs.Sample.prototype.cut=function(e){var t,i=this.wsample;i&&e<i.duration&&(t=gs.sampleCreate(this.gsfile,this.track.id,i.when+e),t.slip(i.offset+e),t.duration(i.duration-e),this.duration(e),wa.composition.update(t.wsample,"mv"),wa.composition.update(this.wsample,"mv"))},gs.Sample.prototype.delete=function(){this.wsample&&(this.wsample.stop(),this.track.removeSample(this),wa.composition.removeSamples([this.wsample],"rm"),ui.CSS_sampleDelete(this))},gs.Sample.prototype.duration=function(e){this.wsample&&(this.wsample.duration=Math.max(0,Math.min(e,this.wsample.bufferDuration)),ui.CSS_sampleDuration(this))},gs.Sample.prototype.inTrack=function(e){var t=ui.tracks[e];t!==this.track&&this.wsample&&(this.wsample.disconnect(),this.wsample.connect(t.wfilters),this.track&&this.track.removeSample(this),this.track=t,this.track.samples.push(this),ui.CSS_sampleTrack(this))},gs.Sample.prototype.mute=function(){lg("sample muted (in development)")},gs.Sample.prototype.select=function(e){this.selected=!!e&&!!this.wsample,ui.CSS_sampleSelect(this)},gs.Sample.prototype.slip=function(e){var t=this.wsample;t&&(t.offset=Math.min(t.bufferDuration,Math.max(e,0)),ui.CSS_sampleOffset(this))},gs.Sample.prototype.when=function(e){this.wsample&&(this.wsample.when=e,ui.CSS_sampleWhen(this))},function(){function e(e,t){t=t.deltaY,gs.bpm(gs._bpm+(t>0?-e:t?e:0))}ui.elBpmInt.onwheel=e.bind(null,1),ui.elBpmDec.onwheel=e.bind(null,.01),ui.elBpm.onmousedown=function(e){ui.elBpm.classList.toggle("clicked"),e.stopPropagation()},ui.elBpmList.onmousedown=function(e){var t=+e.target.textContent;return t&&gs.bpm(t),!1},document.body.addEventListener("mousedown",function(){ui.elBpm.classList.remove("clicked")})}(),ui.elTimeline.onmouseup=function(e){gs.currentTime(ui.getGridSec(e.pageX))},ui.elClockUnits.onclick=function(e){var t=e.target.className;return"s"!==t&&"b"!==t||ui.setClockUnit(gs.clockUnit=t),!1},function(){var e,t=!1,i={panel:function(e){var t=e.pageX;ui.setFilesWidth(t<35?0:t)},trackNames:function(e){var t=e.pageX-ui.elGrid.getBoundingClientRect().left;ui.setTrackNamesWidth(t<35?0:t)}};wisdom.qSA(".extend").forEach(function(n){n.onmousedown=function(n){0===n.button&&(t=!0,ui.cursor("app","col-resize"),e=i[this.dataset.mousemoveFn])}}),document.body.addEventListener("mouseup",function(e){0===e.button&&t&&(t=!1,ui.cursor("app",null))}),document.body.addEventListener("mousemove",function(i){t&&e(i)})}(),function(){function e(t){return new Promise(function(i){if(t.isFile)t.file(function(e){e.type&&"text/plain"!==e.type?s.push(e):n||(n=e,gs.reset()),i()});else if(t.isDirectory){var a=t.createReader();a.readEntries(function(t){var n=[];t.forEach(function(t){n.push(e(t))}),Promise.all(n).then(i)})}})}function t(t){for(var s,a=0,o=[];s=t[a++];)(s=s.webkitGetAsEntry())&&o.push(e(s));Promise.all(o).then(function(){gs.load(n).then(function(){i()})})}function i(){s.forEach(function(e){gs.files.some(function(t){var i=t.file?t.file.size:t.size;if(t.fullname===e.name&&i===e.size)return t.file||t.joinFile(e),!0})||gs.fileCreate(e)})}var n,s=[];document.body.ondragover=function(){return!1},document.body.ondrop=function(e){var a=e&&e.dataTransfer;if(s=[],n=!1,a.items)t(a.items);else if(a.files.length){for(var o,l=0;o=a.files[l++];)o.type&&"text/plain"!==o.type?s.push(o):n||(n=o,gs.reset());gs.load(n).then(function(){i()})}else alert("Your browser doesn't support folders.");return!1}}(),function(){function e(e){return n.every(function(t){return t===e||!i.contains(t)})}function t(e){i.toggle("used",e),i.toggle("loaded",e),i.toggle("unloaded",e)}ui.elFileFilters.onclick=ui.elFileFilters.oncontextmenu=function(){return!1},ui.elFileFilters.onmouseup=function(n){var s,a=n.target;"A"===a.nodeName&&(0===n.button?i.toggle(a.className):2===n.button&&(s=i.contains(a.className)&&e(a.className),t(s),s||i.add(a.className)))};var i=ui.elFileFilters.classList,n=["used","loaded","unloaded"];t(!0)}(),function(){function e(){n&&(ui.selectTool(n),n=null),t=!1}ui.px_x=ui.px_y=ui.px_xRel=ui.px_yRel=0,window.addEventListener("blur",e),ui.elGridCols.onwheel=function(e){if("zoom"===ui.currentTool)return ui.tool.zoom.wheel(e),!1},ui.elGridCols.onscroll=function(){ui.gridScrollTop=ui.elGridCols.scrollTop,ui.updateGridTopShadow()},ui.elTrackLines.oncontextmenu=function(){return!1},ui.elTrackLines.onmousedown=function(e){if(!t){t=!0,i=ui.getGridSec(e.pageX),ui.px_x=e.pageX,ui.px_y=e.pageY,2===e.button&&(n=ui.currentTool,ui.selectTool("delete"));var s=ui.tool[ui.currentTool].mousedown;s&&s(e)}},document.body.onwheel=function(e){if(e.ctrlKey)return!1},document.body.addEventListener("mousemove",function(e){if(t){var n=ui.tool[ui.currentTool].mousemove,s=ui.getGridSec(e.pageX);ui.px_xRel=e.pageX-ui.px_x,ui.px_yRel=e.pageY-ui.px_y,ui.px_x=e.pageX,ui.px_y=e.pageY,n&&(i+=n(e,s-i))}}),document.body.addEventListener("mouseup",function(i){if(t){var n=ui.tool[ui.currentTool].mouseup;n&&n(i),e()}});var t,i,n}(),function(){function e(e){i=ui.currentTool,ui.selectTool(e.name)}function t(t,n){"keydown"===n.type?e(t):i&&(ui.selectTool(i),i=null)}keyboardRouter({fn:t,when:"down,up",keys:["alt"],name:"hand"},{fn:t,when:"down,up",keys:["ctrl"],name:"zoom"},{fn:t,when:"down,up",keys:["shift"],name:"select"},{fn:e,keys:["z"],name:"zoom"},{fn:e,keys:["s"],name:"slip"},{fn:e,keys:["d"],name:"delete"},{fn:e,keys:["c"],name:"cut"},{fn:e,keys:["v"],name:"select"},{fn:e,keys:["b"],name:"paint"},{fn:e,keys:["h"],name:"hand"},{fn:gs.playStop,keys:[" "]},{fn:gs.playPause,keys:["ctrl"," "]},{fn:gs.samplesDelete,keys:["delete"]},{fn:ui.toggleMagnetism,keys:["g"]},{fn:gs.samplesCopy,keys:["ctrl","c"]},{fn:gs.samplesPaste,keys:["ctrl","v"]},{fn:gs.history.undo,keys:["ctrl","z"]},{fn:gs.history.redo,keys:["ctrl","shift","z"]});var i}(),ui.elBtnFiles.onclick=ui.panelSection.bind(null,"files"),ui.elBtnHistory.onclick=ui.panelSection.bind(null,"history"),ui.elPlay.onclick=gs.playPause,ui.elStop.onclick=gs.stop,wa.composition.onended(gs.compositionStop),window.onresize=ui.resize(),ui.elBtnSave.onclick=function(){var e=gs.save();ui.elBtnSave.setAttribute("href",e.href),ui.elBtnSave.setAttribute("download",e.download)},ui.elBtnMagnet.onclick=ui.toggleMagnetism,ui.elToolBtns.tool={},ui.elToolBtns.forEach(function(e){ui.elToolBtns.tool[e.dataset.tool]=e,e.onclick=ui.selectTool.bind(null,e.dataset.tool)}),function(){var e;ui.tool.cut={mousedown:function(t){e=t.target.gsSample},mouseup:function(t){e&&gs.samplesCut(e,ui.getGridSec(t.pageX)),e=null}}}(),ui.tool.delete={mousedown:function(e){gs.sampleDelete(e.target.gsSample)},mousemove:function(e){gs.sampleDelete(e.target.gsSample)}},ui.tool.hand={start:function(){ui.cursor("grid","grab")},end:function(){ui.cursor("grid",null)},mousedown:function(){ui.cursor("app","grabbing")},mouseup:function(){ui.cursor("app",null)},mousemove:function(e){ui.setTrackLinesLeft(ui.trackLinesLeft+ui.px_xRel),ui.setGridScrollTop(ui.gridScrollTop-ui.px_yRel),ui.updateTimeline(),ui.updateTrackLinesBg()}},ui.tool.mute={},function(){ui.tool.paint={mousedown:function(l){var r=l.target.gsSample;!r&&gs.selectedSamples.length?(pushAction(null,gs.selectedSamples.slice()),gs.samplesUnselect()):r&&(o.push(r.wsample.when,r.wsample.offset,r.wsample.duration,r.track.id),i=l.target.classList.contains("start"),t=i||l.target.classList.contains("end"),t?(n=i?gs.history.crop:gs.history.endCrop,s=i?gs.history.undoCrop:gs.history.undoEndCrop,a=i?"crop":"endCrop",r[i?"elCropStart":"elCropEnd"].classList.add("hover")):(n=gs.history.moveX,s=gs.history.undoMoveX,a="move"),e=r,ui.cursor("app",t?i?"w-resize":"e-resize":"grabbing"))},mouseup:function(){e&&(gs.samplesForEach(e,function(e){wa.composition.update(e.wsample,"mv")}),t&&(e[i?"elCropStart":"elCropEnd"].classList.remove("hover"),t=i=!1),e.xem==o[0]&&e.wsample.offset==o[1]&&e.wsample.duration==o[2]&&e.track.id==o[3]||(gs.history.push({name:a,action:{func:n,sample:e,whenDiff:e.wsample.when-o[0],offset:e.wsample.offset-o[1],durationDiff:o[2]-e.wsample.duration,trackId:e.track.id,changeTrack:e.track.id!=o[3]},undo:{func:s,sample:e,whenDiff:o[0]-e.wsample.when,offset:o[1]-e.wsample.offset,durationDiff:e.wsample.duration-o[2],trackId:o[3],changeTrack:e.track.id!=o[3]}}),n=s=null,a="",o=[]),e=null,ui.cursor("app",null))},mousemove:function(n,s){if(e){if(!t){n=n.target;var a,o=1/0,l=n.uitrack||n.gsSample&&n.gsSample.track;l&&(e.selected?(a=l.id-e.track.id,a<0&&(gs.selectedSamples.forEach(function(e){o=Math.min(e.track.id,o)}),a=-Math.min(o,-a)),gs.selectedSamples.forEach(function(e){e.inTrack(e.track.id+a)})):e.inTrack(l.id))}return t?i?gs.samplesCropStart(e,s):gs.samplesCropEnd(e,s):gs.samplesWhen(e,s)}}};var e,t,i,n,s,a,o=[]}(),function(){ui.tool.select={mousedown:function(i){var n=i.target.gsSample;r=gs.selectedSamples.slice(),i.shiftKey||(c=gs.selectedSamples.slice(),gs.samplesUnselect()),n&&(gs.sampleSelect(n,!n.selected),l.push(n)),e=i.pageX,t=i.pageY,s=!0},mouseup:function(e){s=a=!1,wisdom.css(d,"width","0px"),wisdom.css(d,"height","0px"),d.remove(),0===Object.keys(e).length||isSameArray(gs.selectedSamples,r)||(pushAction(l,c),c=null,l=[],o="")},mousemove:function(o){if(s){var r,c,p=o.pageX,f=o.pageY;if(!a&&Math.max(Math.abs(p-e),Math.abs(f-t))>5&&(++u,a=!0,i=ui.getTrackFromPageY(t).id,n=ui.getGridSec(e),ui.elTrackLines.appendChild(d)),a){r=ui.getTrackFromPageY(f),r=r?r.id:0,c=Math.max(0,ui.getGridSec(p));var m=Math.min(i,r),h=Math.max(i,r),g=Math.min(n,c),v=Math.max(n,c);gs.samples.forEach(function(e){if(e.wsample){var t,i,n=e.track.id;if(m<=n&&n<=h&&(t=e.wsample.when,i=t+e.wsample.duration,g<=t&&t<v||g<i&&i<=v||t<=g&&v<=i))return void(e.selected||(e.squareSelected=u,gs.sampleSelect(e,!0),l.push(e)));e.squareSelected===u&&(gs.sampleSelect(e,!1),l.push(e))}}),wisdom.css(d,"top",m+"em"),wisdom.css(d,"left",g*ui.BPMem+"em"),wisdom.css(d,"width",(v-g)*ui.BPMem+"em"),
wisdom.css(d,"height",h-m+1+"em")}}}};var e,t,i,n,s,a,o,l=[],r=[],u=0,c=null,d=wisdom.cE("<div id='squareSelection'>")[0]}(),function(){var e,t;ui.tool.slip={mousedown:function(i){e=i.target.gsSample,e&&(t=e.wsample.offset)},mouseup:function(){e&&(gs.history.push({name:"slip",action:{func:gs.history.slip,sample:e,offsetDiff:t-e.wsample.offset},undo:{func:gs.history.undoSlip,sample:e,offsetDiff:e.wsample.offset-t}}),gs.samplesForEach(e,function(e){wa.composition.update(e.wsample,"mv")})),e=null},mousemove:function(t,i){if(e)return gs.samplesSlip(e,i)}}}(),function(){function e(e,t){ui.setGridZoom(ui.gridZoom*t,e.pageX-ui.filesWidth-ui.trackNamesWidth,e.pageY-ui.gridColsY)}ui.tool.zoom={start:function(){ui.cursor("grid","zoom-in")},end:function(){ui.cursor("grid",null)},keydown:function(e){18===e.keyCode&&ui.cursor("grid","zoom-out")},keyup:function(e){18===e.keyCode&&ui.cursor("grid","zoom-in")},wheel:function(t){e(t,t.deltaY<0?1.1:.9)},mousedown:function(t){0===t.button&&e(t,t.altKey?.7:1.3)}}}(),ui.resize(),ui.setFilesWidth(200),ui.setTrackLinesLeft(0),ui.setTrackNamesWidth(125),ui.setGridZoom(1.5,0,0),ui.analyserToggle(!0),ui.toggleMagnetism(!0),ui.updateTrackLinesBg(),ui.historyReset(),gs.bpm(120),gs.currentTime(0),ui.elBtnFiles.click(),wisdom.qS(ui.elClockUnits,".s").click(),wisdom.qS(ui.elMenu,"[data-tool='paint']").click();for(var i=0;i<42;++i)ui.newTrack();